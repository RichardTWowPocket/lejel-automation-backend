services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: lejel-backend
    restart: unless-stopped
    # No ports exposed - only accessible via reverse proxy network
    environment:
      - NODE_ENV=production
      - PORT=3000
      - WHISPER_SERVICE_URL=http://whisper-worker:8000
      - DOCKER_SOCKET_PATH=/var/run/docker.sock
    env_file:
      - .env
    volumes:
      - ./temp:/app/temp
      - ./public/media:/app/public/media
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - lejel-network
      - shared-services-network  # For accessing shared whisper-worker
    # Removed depends_on - container will start on-demand

  # whisper-worker is now a shared service
  # See /root/shared/whisper-worker/

networks:
  lejel-network:
    driver: bridge
    name: lejel-network  # External name for reverse proxy access
  shared-services-network:
    external: true
    name: shared-services-network  # For accessing shared whisper-worker

# volumes:
# whisper-cache volume removed - now managed by shared service

